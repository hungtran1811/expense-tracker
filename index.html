<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>H∆∞ng Tr√¢ÃÄn ‚Ä¢ ht</title>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./assets/img/favicon_32.png"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/app.css" />
  </head>
  <body>
    <div class="app-shell d-flex">
      <!-- ================= Sidebar ================= -->
      <aside class="sidebar d-flex flex-column position-fixed h-100">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <a class="navbar-brand d-flex align-items-center" href="#dashboard">
            <img
              src="./assets/img/favicon_64.png"
              alt="ht logo"
              height="28"
              class="me-2"
            />
            <span class="fw-semibold name">ht Studio</span>
          </a>

          <!-- N√∫t thu g·ªçn sidebar tr√™n desktop -->
          <button
            type="button"
            class="btn btn-sm btn-outline-secondary d-none d-lg-inline-flex"
            id="btnSidebarMini"
            aria-label="Thu g·ªçn sidebar"
          >
            <i class="bi bi-layout-sidebar-inset"></i>
          </button>
        </div>

        <hr class="border-secondary" />
        <nav id="sidebar" class="px-3 pt-3">
          <!-- Group 1: T√†i ch√≠nh c√° nh√¢n -->
          <div
            class="mb-2 small text-uppercase text-secondary fw-semibold section-label"
          >
            T√†i ch√≠nh c√° nh√¢n
          </div>

          <div class="nav flex-column">
            <button
              class="btn btn-sm btn-light d-flex w-100 justify-content-between align-items-center mb-2"
              data-bs-toggle="collapse"
              data-bs-target="#navFinance"
              aria-expanded="true"
            >
              <span>
                <i class="bi bi-wallet2 me-2"></i>
                <span class="label">Qu·∫£n l√Ω chi ti√™u</span>
              </span>
              <i class="bi bi-chevron-down small"></i>
            </button>

            <div class="collapse show" id="navFinance">
              <a
                href="#dashboard"
                class="nav-link py-1 px-2"
                data-nav="overview"
              >
                <i class="bi bi-speedometer2 me-2"></i>
                <span class="label">T·ªïng quan</span>
              </a>
              <a
                href="#expenses"
                class="nav-link py-1 px-2"
                data-nav="expenses"
              >
                <i class="bi bi-table me-2"></i>
                <span class="label">Chi ti√™u</span>
              </a>
              <a
                href="#add-expense"
                class="nav-link py-1 px-2"
                data-nav="add-expense"
              >
                <i class="bi bi-plus-circle me-2"></i>
                <span class="label">Th√™m chi</span>
              </a>
              <a
                href="#accounts"
                class="nav-link py-1 px-2"
                data-nav="accounts"
              >
                <i class="bi bi-bank me-2"></i>
                <span class="label">T√†i kho·∫£n</span>
              </a>
              <a href="#reports" class="nav-link py-1 px-2" data-nav="reports">
                <i class="bi bi-graph-up-arrow me-2"></i>
                <span class="label">B√°o c√°o</span>
              </a>
              <a href="#ai" class="nav-link py-1 px-2" data-nav="ai">
                <i class="bi bi-stars me-2"></i>
                <span class="label">AI h·ªó tr·ª£</span>
              </a>
            </div>
          </div>

          <!-- Group 2: D·∫°y h·ªçc -->
          <div
            class="mt-4 mb-2 small text-uppercase text-secondary fw-semibold section-label"
          >
            D·∫°y h·ªçc
          </div>

          <div class="nav flex-column mb-3">
            <button
              class="btn btn-sm btn-light d-flex w-100 justify-content-between align-items-center mb-2"
              data-bs-toggle="collapse"
              data-bs-target="#navTeaching"
              aria-expanded="false"
            >
              <span>
                <i class="bi bi-mortarboard me-2"></i>
                <span class="label">L·ªõp h·ªçc c·ªßa t√¥i</span>
              </span>
              <i class="bi bi-chevron-down small"></i>
            </button>

            <div class="collapse" id="navTeaching">
              <a
                href="#class-progress"
                class="nav-link py-1 px-2"
                data-nav="class-progress"
              >
                <i class="bi bi-bar-chart-steps me-2"></i>
                <span class="label">Ti·∫øn ƒë·ªô l·ªõp h·ªçc</span>
              </a>
            </div>
          </div>
        </nav>
      </aside>

      <div id="sidebarBackdrop" class="sidebar-backdrop d-lg-none"></div>

      <!-- ================= Main content ================= -->
      <main class="content flex-grow-1">
        <!-- Top navbar -->
        <nav class="navbar navbar-expand-lg sticky-top">
          <div
            class="container-fluid d-flex align-items-center justify-content-between"
          >
            <!-- N√∫t m·ªü sidebar tr√™n mobile -->
            <div class="d-flex align-items-center">
              <button
                type="button"
                class="btn btn-link d-lg-none me-2 p-0 border-0 text-reset"
                id="btnSidebarToggle"
                aria-label="M·ªü menu"
              >
                <i class="bi bi-list fs-3"></i>
              </button>

              <!-- NAV STATS: Chi / Thu th√°ng n√†y -->
              <div
                id="navStats"
                class="d-flex align-items-center flex-wrap gap-2"
              >
                <span class="badge bg-light text-dark nav-stat">
                  Chi: <strong id="navExpTotal">0ƒë</strong>
                </span>
                <span class="badge bg-light text-dark nav-stat">
                  Thu: <strong id="navIncTotal">0ƒë</strong>
                </span>
              </div>
            </div>

            <!-- Actions + user menu -->
            <div class="top-actions d-md-flex justify-content-end ms-auto mb-0">
              <button
                class="btn btn-outline-secondary w-100 w-md-auto mb-2 mb-md-0"
                id="btnExportCsv"
              >
                <i class="bi bi-cloud-arrow-up me-1"></i>Xu·∫•t CSV
              </button>

              <div class="btn-group ms-md-3 ms-0">
                <button
                  type="button"
                  class="btn btn-secondary dropdown-toggle"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  id="btnUserMenu"
                >
                  <i class="bi bi-person-circle me-1"></i>
                  <span id="userNameLabel">Kh√°ch</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li id="menu-login">
                    <button class="dropdown-item" id="btnLoginGoogle">
                      ƒêƒÉng nh·∫≠p Google
                    </button>
                  </li>
                  <li id="menu-logout" class="d-none">
                    <button class="dropdown-item" id="btnLogout">
                      ƒêƒÉng xu·∫•t
                    </button>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </nav>

        <div class="container-fluid p-3 p-md-4">
          <!-- ========== Dashboard ========== -->
          <section id="dashboard" class="route active">
            <div class="row g-3">
              <div class="col-12 col-lg-4">
                <div class="card p-3">
                  <div class="d-flex justify-content-between align-items-start">
                    <h6 class="muted">T·ªïng chi th√°ng n√†y</h6>
                    <span class="badge badge-soft" id="monthBadge"></span>
                  </div>
                  <h3 class="mt-2" id="totalThisMonth"></h3>
                  <p class="muted small" id="deltaMonth"></p>
                </div>
              </div>

              <div class="col-12 col-lg-4">
                <!-- Card s·ªë d∆∞ theo t√†i kho·∫£n -->
                <div class="card">
                  <div class="card-body">
                    <h6 class="card-title mb-2">S·ªë d∆∞ theo t√†i kho·∫£n</h6>
                    <div id="balanceList" class="small">
                      <!-- renderBalancesList() s·∫Ω ƒë·ªï d·ªØ li·ªáu t·∫°i ƒë√¢y -->
                      <div class="text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-lg-4">
                <div class="card p-3">
                  <h6 class="muted">Top danh m·ª•c</h6>
                  <div class="d-grid gap-2" id="topCats">
                    <!-- renderTopCategories() -->
                  </div>
                </div>
              </div>

              <div class="row g-3 mt-2" id="overview-lower">
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      Giao d·ªãch g·∫ßn nh·∫•t
                    </div>
                    <div class="card-body p-0">
                      <ul
                        class="list-group list-group-flush"
                        id="ov-recent"
                      ></ul>
                    </div>
                  </div>
                </div>

                <!-- Top 5 kho·∫£n chi -->
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      Top 5 kho·∫£n chi (th√°ng n√†y)
                    </div>
                    <div class="card-body p-0">
                      <ul class="list-group list-group-flush" id="ov-top5"></ul>
                    </div>
                  </div>
                </div>

                <!-- Chi theo danh m·ª•c -->
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      Chi theo danh m·ª•c (th√°ng n√†y)
                    </div>
                    <div class="card-body" id="ov-cat"></div>
                  </div>
                </div>

                <!-- C·∫£nh b√°o & ghi ch√∫ -->
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      C·∫£nh b√°o & ghi ch√∫
                    </div>
                    <div class="card-body" id="ov-alerts">
                      <div class="text-muted">Kh√¥ng c√≥ c·∫£nh b√°o.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== Expenses ========== -->
          <section id="expenses" class="route">
            <div
              class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3"
            >
              <div>
                <h4 class="mb-1">Chi ti√™u</h4>
                <div id="expenseFilterInfo" class="text-muted small">
                  ƒêang hi·ªÉn th·ªã t·∫•t c·∫£ kho·∫£n chi trong th√°ng.
                </div>
              </div>

              <!-- Nh√≥m filter chi ti·∫øt -->
              <div
                class="d-flex flex-wrap align-items-center gap-2 filters-group"
                id="expenseFilters"
              >
                <!-- Th√°ng -->
                <select
                  class="form-select form-select-sm"
                  style="min-width: 140px"
                  id="monthFilter"
                ></select>

                <!-- Danh m·ª•c -->
                <select
                  class="form-select form-select-sm"
                  style="min-width: 150px"
                  id="filterCategory"
                >
                  <option value="all">T·∫•t c·∫£ danh m·ª•c</option>
                </select>

                <!-- T√†i kho·∫£n -->
                <select
                  class="form-select form-select-sm"
                  style="min-width: 150px"
                  id="filterAccount"
                >
                  <option value="all">T·∫•t c·∫£ t√†i kho·∫£n</option>
                </select>

                <!-- T√™n / ghi ch√∫ -->
                <input
                  type="search"
                  class="form-control form-control-sm"
                  style="min-width: 180px"
                  id="filterSearch"
                  placeholder="T√¨m theo t√™n / ghi ch√∫..."
                />
              </div>
            </div>
            <div class="card p-3">
              <div class="table-responsive">
                <table
                  class="table table-hover align-middle"
                  id="expensesTable"
                >
                  <thead>
                    <tr>
                      <th>Ng√†y</th>
                      <th>T√™n</th>
                      <th>Danh m·ª•c</th>
                      <th>T√†i kho·∫£n</th>
                      <th>S·ªë ti·ªÅn</th>
                      <th class="text-end">Thao t√°c</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </section>

          <!-- ========== Add Expense ========== -->
          <section id="add-expense" class="route">
            <div class="row g-3">
              <div class="col-12 col-xl-12">
                <div class="card p-3">
                  <h4>Th√™m chi ti√™u</h4>
                  <div class="row g-3">
                    <div class="col-12">
                      <label class="form-label">T√™n kho·∫£n chi</label>
                      <input
                        type="text"
                        class="form-control"
                        id="eName"
                        placeholder="V√≠ d·ª•: Coffee s√°ng"
                      />
                    </div>
                    <div class="col-6">
                      <label class="form-label">S·ªë ti·ªÅn</label>
                      <input
                        type="number"
                        class="form-control"
                        id="eAmount"
                        placeholder="0"
                      />
                    </div>
                    <div class="col-6">
                      <label class="form-label">Ng√†y</label>
                      <input type="date" class="form-control" id="eDate" />
                    </div>
                    <div class="col-6">
                      <label class="form-label">Danh m·ª•c</label>
                      <select class="form-select" id="eCategory">
                        <option>ƒÇn u·ªëng</option>
                        <option>Coffee</option>
                        <option>
                          CaÃÅ nh√¢n (ƒê√¥ÃÄ ƒëi√™Ã£n t∆∞Ãâ, qu√¢ÃÄn aÃÅo, giaÃÄy deÃÅp, cƒÉÃÅt toÃÅc, ...)
                        </option>
                        <option>Ti·ªÅn nh√†</option>
                        <option>Th·ªÉ thao</option>
                        <option>Si√™u th·ªã</option>
                        <option>Xe c√¥Ã£</option>
                        <option>Y t√™ÃÅ</option>
                        <option>Cho m∆∞·ª£n</option>
                        <option>Kh√°c</option>
                      </select>
                    </div>
                    <div class="col-6">
                      <label class="form-label">T√†i kho·∫£n</label>
                      <select class="form-select" id="eAccount">
                        <option>MSB</option>
                        <option>Sacombank</option>
                        <option>T√∫i th·∫ßn t√†i MoMo</option>
                        <option>VPBank</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Ghi ch√∫</label>
                      <textarea
                        class="form-control"
                        id="eNote"
                        rows="2"
                        placeholder="M√¥ t·∫£ ng·∫Øn (t√πy ch·ªçn)"
                      ></textarea>
                    </div>
                    <div class="col-12 d-flex justify-content-end gap-2">
                      <button class="btn btn-outline-secondary" id="btnDraft">
                        L∆∞u nh√°p
                      </button>
                      <button class="btn btn-primary" id="btnAddExpense">
                        Th√™m
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== Modals: Account & Income (l·∫ßn khai b√°o ch√≠nh) ========== -->

          <!-- Add Account Modal -->
          <div class="modal" id="addAccountModal" tabindex="-1">
            <div class="modal-dialog modal-md modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Th√™m t√†i kho·∫£n</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="mb-2">
                    <label class="form-label">T√™n t√†i kho·∫£n</label>
                    <input
                      class="form-control"
                      id="aName"
                      placeholder="VD: MSB, MoMo..."
                    />
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Lo·∫°i</label>
                    <select class="form-select" id="aType">
                      <option value="bank">Ng√¢n h√†ng</option>
                      <option value="ewallet">V√≠ ƒëi·ªán t·ª≠</option>
                      <option value="other">Kh√°c</option>
                    </select>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="aDefault"
                    />
                    <label class="form-check-label" for="aDefault"
                      >ƒê·∫∑t l√†m m·∫∑c ƒë·ªãnh</label
                    >
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Hu·ª∑
                  </button>
                  <button class="btn btn-primary" id="btnAddAccount">
                    Th√™m
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Edit Account Modal -->
          <div class="modal" id="editAccountModal" tabindex="-1">
            <div class="modal-dialog modal-md modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">S·ª≠a t√†i kho·∫£n</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" id="eaId" />
                  <div class="mb-2">
                    <label class="form-label">T√™n t√†i kho·∫£n</label>
                    <input class="form-control" id="eaName" />
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Lo·∫°i</label>
                    <select class="form-select" id="eaType">
                      <option value="bank">Ng√¢n h√†ng</option>
                      <option value="ewallet">V√≠ ƒëi·ªán t·ª≠</option>
                      <option value="other">Kh√°c</option>
                    </select>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="eaDefault"
                    />
                    <label class="form-check-label" for="eaDefault"
                      >ƒê·∫∑t l√†m m·∫∑c ƒë·ªãnh</label
                    >
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Hu·ª∑
                  </button>
                  <button class="btn btn-primary" id="btnSaveAccount">
                    L∆∞u
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Add Income Modal -->
          <div class="modal" id="addIncomeModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Th√™m thu nh·∫≠p</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">T√™n thu nh·∫≠p</label>
                      <input
                        class="form-control"
                        id="iName"
                        placeholder="L∆∞∆°ng, th∆∞·ªüng, refund..."
                      />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">S·ªë ti·ªÅn</label>
                      <input class="form-control" id="iAmount" type="number" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Ng√†y</label>
                      <input class="form-control" id="iDate" type="date" />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">T√†i kho·∫£n</label>
                      <select class="form-select" id="iAccount">
                        <!-- danh s√°ch account t·ª´ Firestore -->
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Ghi ch√∫</label>
                      <textarea
                        class="form-control"
                        id="iNote"
                        rows="2"
                      ></textarea>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Hu·ª∑
                  </button>
                  <button class="btn btn-primary" id="btnAddIncome">
                    Th√™m
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal S·ª¨A THU NH·∫¨P -->
          <div class="modal fade" id="editIncomeModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">S·ª≠a thu nh·∫≠p</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" id="eiId" />
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">T√™n thu nh·∫≠p</label>
                      <input class="form-control" id="eiName" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">S·ªë ti·ªÅn</label>
                      <input class="form-control" id="eiAmount" type="number" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Ng√†y</label>
                      <input class="form-control" id="eiDate" type="date" />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">T√†i kho·∫£n</label>
                      <select class="form-select" id="eiAccount"></select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Ghi ch√∫</label>
                      <textarea
                        class="form-control"
                        id="eiNote"
                        rows="2"
                      ></textarea>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Hu·ª∑
                  </button>
                  <button class="btn btn-primary" id="btnSaveIncome">
                    L∆∞u thay ƒë·ªïi
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== Accounts section ========== -->
          <section id="accounts" class="route">
            <div class="row g-3">
              <div class="col-12 col-xl-6">
                <div class="card p-3">
                  <!-- Thu nh·∫≠p trong th√°ng -->
                  <div class="card mt-3">
                    <div class="card-body">
                      <div
                        class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-2 mb-2"
                      >
                        <h6 class="mb-0">Thu nh·∫≠p (th√°ng n√†y)</h6>
                        <div class="d-flex flex-wrap gap-2 income-actions">
                          <!-- üîπ M·ªöI: ch·ªçn th√°ng cho thu nh·∫≠p -->
                          <select
                            id="incomeMonthFilter"
                            class="form-select form-select-sm"
                            style="min-width: 140px"
                          >
                            <!-- S·∫Ω ƒë∆∞·ª£c ƒë·ªìng b·ªô options v·ªõi #monthFilter b·∫±ng JS -->
                          </select>

                          <!-- Filter t√†i kho·∫£n thu nh·∫≠p -->
                          <select
                            id="incomeAccountFilter"
                            class="form-select form-select-sm"
                            style="min-width: 140px"
                          >
                            <option value="all">T·∫•t c·∫£ t√†i kho·∫£n</option>
                          </select>

                          <!-- T√¨m theo t√™n / ghi ch√∫ -->
                          <input
                            id="incomeSearch"
                            type="search"
                            class="form-control form-control-sm"
                            placeholder="T√¨m theo t√™n / ghi ch√∫"
                            style="min-width: 180px"
                          />
                          <button
                            class="btn btn-outline-success btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#transferModal"
                          >
                            ‚ÜîÔ∏è Chuy·ªÉn ti·ªÅn
                          </button>

                          <button
                            class="btn btn-outline-success btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#addIncomeModal"
                          >
                            + Th√™m thu nh·∫≠p
                          </button>
                        </div>
                      </div>
                      <div
                        id="incomeFilterInfo"
                        class="text-muted small mt-1"
                      ></div>

                      <div class="table-responsive">
                        <table class="table align-middle" id="incomesTable">
                          <thead>
                            <tr>
                              <th>Ng√†y</th>
                              <th>T√™n</th>
                              <th>T√†i kho·∫£n</th>
                              <th>S·ªë ti·ªÅn</th>
                              <th class="text-end">Thao t√°c</th>
                            </tr>
                          </thead>
                          <tbody></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-xl-6">
                <div class="card p-3">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <h5 class="mb-0">T√†i kho·∫£n</h5>
                    <div class="d-flex justify-content-end mb-2">
                      <button
                        class="btn btn-primary btn-sm"
                        data-bs-toggle="modal"
                        data-bs-target="#addAccountModal"
                      >
                        + Th√™m t√†i kho·∫£n
                      </button>
                    </div>
                  </div>
                  <table class="table align-middle" id="accountsTable">
                    <thead>
                      <tr>
                        <th>T√™n</th>
                        <th>Lo·∫°i</th>
                        <th>M·∫∑c ƒë·ªãnh</th>
                        <th class="text-end">Thao t√°c</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>

                  <ul class="list-group list-group-flush" id="accountList"></ul>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== Reports ========== -->
          <section id="reports" class="route">
            <div class="row g-3">
              <div class="col-12 col-xl-8">
                <div class="card p-3">
                  <h5>T·ªïng quan b√°o c√°o</h5>

                  <!-- B·ªô l·ªçc b√°o c√°o -->
                  <div class="d-flex flex-wrap align-items-center gap-2 my-3">
                    <!-- T√†i kho·∫£n -->
                    <select
                      id="accountSelect"
                      class="form-select"
                      style="max-width: 200px"
                    >
                      <option value="all">T·∫•t c·∫£ t√†i kho·∫£n</option>
                    </select>

                    <!-- N√∫t √°p d·ª•ng -->
                    <button class="btn btn-primary" id="btnApplyReport">
                      <i class="bi bi-funnel me-1"></i> √Åp d·ª•ng
                    </button>
                  </div>

                  <!-- Nh·∫≠n x√©t nhanh -->
                  <div class="card p-3 mb-3" id="reportInsights">
                    <h5 class="mb-2">Nh·∫≠n x√©t nhanh</h5>
                    <div id="reportInsightsBody" class="text-muted small">
                      ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...
                    </div>
                  </div>

                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="p-3 rounded border" id="barChart">
                        Bi·ªÉu ƒë·ªì c·ªôt (demo)
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="p-3 rounded border" id="pieChart">
                        Bi·ªÉu ƒë·ªì tr√≤n (demo)
                      </div>
                    </div>
                  </div>

                  <div class="mt-3">
                    <div class="table-responsive">
                      <table class="table" id="reportTable">
                        <thead>
                          <tr>
                            <th>Danh m·ª•c</th>
                            <th>T·ªïng</th>
                            <th>T·ªâ l·ªá</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- Card D√≤ng ti·ªÅn theo ng√†y -->
                <div class="row g-3 mt-3">
                  <div class="col-12 col-xl-8">
                    <div class="card p-3">
                      <div
                        class="d-flex justify-content-between align-items-center mb-2"
                      >
                        <h5 class="mb-0">D√≤ng ti·ªÅn theo ng√†y</h5>
                        <small class="text-muted"
                          >Thu &amp; Chi trong th√°ng hi·ªán t·∫°i</small
                        >
                      </div>

                      <div id="cashflowChart" class="cashflow-chart">
                        <div class="text-muted small">ƒêang t·∫£i d·ªØ li·ªáu...</div>
                      </div>

                      <div class="mt-2 small text-secondary">
                        <span class="me-3">
                          <span class="legend-dot legend-dot-exp"></span> Chi
                        </span>
                        <span>
                          <span class="legend-dot legend-dot-inc"></span> Thu
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== AI demo ========== -->
          <section id="ai" class="route">
            <div class="card p-3">
              <div class="d-flex align-items-center justify-content-between">
                <h4 class="mb-0">AI h·ªó tr·ª£ (demo UI)</h4>
                <div class="d-flex gap-2">
                  <span class="chip">Google AI Studio (Gemini)</span>
                  <span class="chip">Ng·ªØ c·∫£nh: Firestore</span>
                </div>
              </div>
              <hr />
              <div
                class="d-flex flex-column gap-2"
                id="chatArea"
                style="min-height: 220px"
              >
                <div class="chat-bubble bot">
                  Xin ch√†o! M√¨nh c√≥ th·ªÉ gi√∫p ph√¢n lo·∫°i chi ti√™u, g·ª£i √Ω ng√¢n
                  s√°ch, c·∫£nh b√°o v∆∞·ª£t tr·∫ßn.
                </div>
              </div>
              <div class="sticky-actions mt-3">
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="bi bi-stars"></i
                  ></span>
                  <input
                    class="form-control"
                    id="aiInput"
                    placeholder="V√≠ d·ª•: ƒê·ªÅ xu·∫•t ng√¢n s√°ch th√°ng sau cho ƒÇn u·ªëng + Coffee"
                  />
                  <button class="btn btn-primary" id="aiSend">G·ª≠i</button>
                </div>
                <div class="mt-2 d-flex gap-2 flex-wrap">
                  <button class="btn btn-sm btn-outline-secondary">
                    T√≥m t·∫Øt th√°ng
                  </button>
                  <button class="btn btn-sm btn-outline-secondary">
                    T·ªëi ∆∞u t√†i kho·∫£n
                  </button>
                  <button class="btn btn-sm btn-outline-secondary">
                    D·ª± b√°o chi ti√™u
                  </button>
                  <button class="btn btn-sm btn-outline-secondary">
                    C·∫£nh b√°o v∆∞·ª£t tr·∫ßn
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- Settings (demo ‚Äì ƒëang t·∫Øt) -->
          <!--
          <section id="settings" class="route">
            ...
          </section>
          -->
        </div>

        <!-- Mobile Footer -->
        <footer class="mobile-footer d-none">
          <div class="left">
            <i class="bi bi-wallet2"></i>
            <span class="muted">Th√°ng n√†y:</span>
            <strong id="footerTotal">‚Äî</strong>
          </div>
          <div class="right">
            <a class="btn btn-outline-secondary btn-sm" href="#reports"
              ><i class="bi bi-graph-up"></i> B√°o c√°o</a
            >
            <a class="btn btn-primary btn-sm" href="#add-expense"
              ><i class="bi bi-plus"></i> Th√™m</a
            >
          </div>
        </footer>
      </main>
    </div>

    <!-- Floating Add button -->
    <a href="#add-expense" class="btn btn-primary fab-add" title="Th√™m nhanh"
      ><i class="bi bi-plus-lg"></i
    ></a>

    <!-- ================= Toast & Loading ================= -->
    <div
      class="toast-container position-fixed top-0 end-0 p-3"
      style="z-index: 1080"
    >
      <div
        id="appToast"
        class="toast align-items-center border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body">ƒê√£ th·ª±c hi·ªán xong</div>
          <button
            type="button"
            class="btn-close me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
    </div>

    <div
      id="appLoading"
      class="app-loading d-flex align-items-center justify-content-center"
    >
      <div class="spinner-border" role="status" aria-hidden="true"></div>
    </div>

    <!-- ================= C√°c modal c√≤n l·∫°i (Transfer / Delete / Edit Expense) ================= -->

    <!-- Transfer Modal -->
    <div class="modal fade" id="transferModal" tabindex="-1">
      <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Chuy·ªÉn ti·ªÅn gi·ªØa t√†i kho·∫£n</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-2">
              <label class="form-label">T·ª´ t√†i kho·∫£n</label>
              <select class="form-select" id="tfFrom"></select>
            </div>
            <div class="mb-2">
              <label class="form-label">ƒê·∫øn t√†i kho·∫£n</label>
              <select class="form-select" id="tfTo"></select>
            </div>
            <div class="row g-2">
              <div class="col-6">
                <label class="form-label">S·ªë ti·ªÅn</label>
                <input
                  type="number"
                  class="form-control"
                  id="tfAmount"
                  min="0"
                  step="1000"
                />
              </div>
              <div class="col-6">
                <label class="form-label">Ng√†y</label>
                <input type="date" class="form-control" id="tfDate" />
              </div>
            </div>
            <div class="mt-2">
              <label class="form-label">Ghi ch√∫</label>
              <input
                class="form-control"
                id="tfNote"
                placeholder="V√≠ d·ª•: r√∫t ti·∫øt ki·ªám sang MSB"
              />
            </div>
            <div class="form-text mt-2">
              * Chuy·ªÉn ti·ªÅn kh√¥ng l√†m thay ƒë·ªïi t·ªïng Chi/Thu; ch·ªâ ·∫£nh h∆∞·ªüng S·ªë d∆∞
              theo t√†i kho·∫£n.
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Hu·ª∑
            </button>
            <button class="btn btn-primary" id="btnDoTransfer">Chuy·ªÉn</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1">
      <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Xo√° t√†i kho·∫£n</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="daId" />
            <div class="alert alert-warning small">
              T·∫•t c·∫£ <b>Chi ti√™u</b>, <b>Thu nh·∫≠p</b> v√† <b>Chuy·ªÉn ti·ªÅn</b> d√πng
              t√†i kho·∫£n n√†y s·∫Ω ƒë∆∞·ª£c <b>chuy·ªÉn sang</b> t√†i kho·∫£n kh√°c tr∆∞·ªõc khi
              xo√°.
            </div>
            <label class="form-label">Chuy·ªÉn sang t√†i kho·∫£n</label>
            <select id="daTarget" class="form-select"></select>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Hu·ª∑
            </button>
            <button class="btn btn-danger" id="btnConfirmDeleteAccount">
              Chuy·ªÉn & xo√°
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Expense Modal -->
    <div class="modal fade" id="editExpenseModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">S·ª≠a chi ti√™u</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="edId" />
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">T√™n</label>
                <input id="edName" class="form-control" />
              </div>
              <div class="col-md-3">
                <label class="form-label">S·ªë ti·ªÅn</label>
                <input id="edAmount" type="number" class="form-control" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Ng√†y</label>
                <input id="edDate" type="date" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Danh m·ª•c</label>
                <select id="edCategory" class="form-select">
                  <option>ƒÇn u·ªëng</option>
                  <option>Coffee</option>
                  <option>
                    CaÃÅ nh√¢n (ƒê√¥ÃÄ ƒëi√™Ã£n t∆∞Ãâ, qu√¢ÃÄn aÃÅo, giaÃÄy deÃÅp, cƒÉÃÅt toÃÅc, ...)
                  </option>
                  <option>Ti·ªÅn nh√†</option>
                  <option>Th·ªÉ thao</option>
                  <option>Si√™u th·ªã</option>
                  <option>Xe c√¥Ã£</option>
                  <option>Y t√™ÃÅ</option>
                  <option>Cho m∆∞·ª£n</option>
                  <option>Kh√°c</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">T√†i kho·∫£n</label>
                <select id="edAccount" class="form-select"></select>
              </div>
              <div class="col-12">
                <label class="form-label">Ghi ch√∫</label>
                <textarea id="edNote" rows="2" class="form-control"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Hu·ª∑
            </button>
            <button class="btn btn-primary" id="btnSaveExpense">
              L∆∞u thay ƒë·ªïi
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirm Delete Expense -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1">
      <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title">Xo√° kho·∫£n chi?</h6>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p class="mb-0">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Hu·ª∑
            </button>
            <button class="btn btn-danger" id="btnConfirmDelete">Xo√°</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ================= Scripts ================= -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./assets/main.js"></script>
    <script type="module">
      // Sidebar toggle (mobile)
      const sidebar = document.querySelector(".sidebar");
      const backdrop = document.getElementById("sidebarBackdrop");
      const toggleBtn = document.getElementById("btnSidebarToggle");

      const closeSidebar = () => {
        sidebar?.classList.remove("show");
        backdrop?.classList.remove("show");
      };

      const openSidebar = () => {
        sidebar?.classList.add("show");
        backdrop?.classList.add("show");
      };

      toggleBtn?.addEventListener("click", () => {
        const isOpen = sidebar?.classList.contains("show");
        if (isOpen) {
          closeSidebar();
        } else {
          openSidebar();
        }
      });

      backdrop?.addEventListener("click", closeSidebar);
      window.addEventListener("hashchange", closeSidebar);
    </script>
  </body>
</html>
