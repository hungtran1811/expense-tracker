<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hưng Trần • ht</title>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./assets/img/favicon_32.png"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/app.css" />
  </head>
  <body>
    <div class="app-shell d-flex">
      <!-- ================= Sidebar ================= -->
      <aside class="sidebar d-flex flex-column position-fixed h-100">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <a class="navbar-brand d-flex align-items-center" href="#dashboard">
            <img
              src="./assets/img/favicon_64.png"
              alt="ht logo"
              height="28"
              class="me-2"
            />
            <span class="fw-semibold name">ht Studio</span>
          </a>

          <!-- Nút thu gọn sidebar trên desktop -->
          <button
            type="button"
            class="btn btn-sm btn-outline-secondary d-none d-lg-inline-flex"
            id="btnSidebarMini"
            aria-label="Thu gọn sidebar"
          >
            <i class="bi bi-layout-sidebar-inset"></i>
          </button>
        </div>

        <hr class="border-secondary" />
        <nav id="sidebar" class="px-3 pt-3">
          <!-- Group 1: Tài chính cá nhân -->
          <div
            class="mb-2 small text-uppercase text-secondary fw-semibold section-label"
          >
            Tài chính cá nhân
          </div>

          <div class="nav flex-column">
            <button
              class="btn btn-sm btn-light d-flex w-100 justify-content-between align-items-center mb-2"
              data-bs-toggle="collapse"
              data-bs-target="#navFinance"
              aria-expanded="true"
            >
              <span>
                <i class="bi bi-wallet2 me-2"></i>
                <span class="label">Quản lý chi tiêu</span>
              </span>
              <i class="bi bi-chevron-down small"></i>
            </button>

            <div class="collapse show" id="navFinance">
              <a
                href="#dashboard"
                class="nav-link py-1 px-2"
                data-nav="overview"
              >
                <i class="bi bi-speedometer2 me-2"></i>
                <span class="label">Tổng quan</span>
              </a>
              <a
                href="#expenses"
                class="nav-link py-1 px-2"
                data-nav="expenses"
              >
                <i class="bi bi-table me-2"></i>
                <span class="label">Chi tiêu</span>
              </a>
              <a
                href="#add-expense"
                class="nav-link py-1 px-2"
                data-nav="add-expense"
              >
                <i class="bi bi-plus-circle me-2"></i>
                <span class="label">Thêm chi</span>
              </a>
              <a
                href="#accounts"
                class="nav-link py-1 px-2"
                data-nav="accounts"
              >
                <i class="bi bi-bank me-2"></i>
                <span class="label">Tài khoản</span>
              </a>
              <a href="#reports" class="nav-link py-1 px-2" data-nav="reports">
                <i class="bi bi-graph-up-arrow me-2"></i>
                <span class="label">Báo cáo</span>
              </a>
              <a href="#ai" class="nav-link py-1 px-2" data-nav="ai">
                <i class="bi bi-stars me-2"></i>
                <span class="label">AI hỗ trợ</span>
              </a>
            </div>
          </div>

          <!-- Group 2: Dạy học -->
          <div
            class="mt-4 mb-2 small text-uppercase text-secondary fw-semibold section-label"
          >
            Dạy học
          </div>

          <div class="nav flex-column mb-3">
            <button
              class="btn btn-sm btn-light d-flex w-100 justify-content-between align-items-center mb-2"
              data-bs-toggle="collapse"
              data-bs-target="#navTeaching"
              aria-expanded="false"
            >
              <span>
                <i class="bi bi-mortarboard me-2"></i>
                <span class="label">Lớp học của tôi</span>
              </span>
              <i class="bi bi-chevron-down small"></i>
            </button>

            <div class="collapse" id="navTeaching">
              <a
                href="#class-progress"
                class="nav-link py-1 px-2"
                data-nav="class-progress"
              >
                <i class="bi bi-bar-chart-steps me-2"></i>
                <span class="label">Tiến độ lớp học</span>
              </a>
            </div>
          </div>
        </nav>
      </aside>

      <div id="sidebarBackdrop" class="sidebar-backdrop d-lg-none"></div>

      <!-- ================= Main content ================= -->
      <main class="content flex-grow-1">
        <!-- Top navbar -->
        <nav class="navbar navbar-expand-lg sticky-top">
          <div
            class="container-fluid d-flex align-items-center justify-content-between"
          >
            <!-- Nút mở sidebar trên mobile -->
            <div class="d-flex align-items-center">
              <button
                type="button"
                class="btn btn-link d-lg-none me-2 p-0 border-0 text-reset"
                id="btnSidebarToggle"
                aria-label="Mở menu"
              >
                <i class="bi bi-list fs-3"></i>
              </button>

              <!-- NAV STATS: Chi / Thu tháng này -->
              <div
                id="navStats"
                class="d-flex align-items-center flex-wrap gap-2"
              >
                <span class="badge bg-light text-dark nav-stat">
                  Chi: <strong id="navExpTotal">0đ</strong>
                </span>
                <span class="badge bg-light text-dark nav-stat">
                  Thu: <strong id="navIncTotal">0đ</strong>
                </span>
              </div>
            </div>

            <!-- Actions + user menu -->
            <div class="top-actions d-md-flex justify-content-end ms-auto mb-0">
              <button
                class="btn btn-outline-secondary w-100 w-md-auto mb-2 mb-md-0"
                id="btnExportCsv"
              >
                <i class="bi bi-cloud-arrow-up me-1"></i>Xuất CSV
              </button>

              <div class="btn-group ms-md-3 ms-0">
                <button
                  type="button"
                  class="btn btn-secondary dropdown-toggle"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  id="btnUserMenu"
                >
                  <i class="bi bi-person-circle me-1"></i>
                  <span id="userNameLabel">Khách</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li id="menu-login">
                    <button class="dropdown-item" id="btnLoginGoogle">
                      Đăng nhập Google
                    </button>
                  </li>
                  <li id="menu-logout" class="d-none">
                    <button class="dropdown-item" id="btnLogout">
                      Đăng xuất
                    </button>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </nav>

        <div class="container-fluid p-3 p-md-4">
          <!-- ========== Dashboard ========== -->
          <section id="dashboard" class="route active">
            <div class="row g-3">
              <div class="col-12 col-lg-4">
                <div class="card p-3">
                  <div class="d-flex justify-content-between align-items-start">
                    <h6 class="muted">Tổng chi tháng này</h6>
                    <span class="badge badge-soft" id="monthBadge"></span>
                  </div>
                  <h3 class="mt-2" id="totalThisMonth"></h3>
                  <p class="muted small" id="deltaMonth"></p>
                </div>
              </div>

              <div class="col-12 col-lg-4">
                <!-- Card số dư theo tài khoản -->
                <div class="card">
                  <div class="card-body">
                    <h6 class="card-title mb-2">Số dư theo tài khoản</h6>
                    <div id="balanceList" class="small">
                      <!-- renderBalancesList() sẽ đổ dữ liệu tại đây -->
                      <div class="text-muted">Chưa có dữ liệu</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-lg-4">
                <div class="card p-3">
                  <h6 class="muted">Top danh mục</h6>
                  <div class="d-grid gap-2" id="topCats">
                    <!-- renderTopCategories() -->
                  </div>
                </div>
              </div>

              <div class="row g-3 mt-2" id="overview-lower">
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      Giao dịch gần nhất
                    </div>
                    <div class="card-body p-0">
                      <ul
                        class="list-group list-group-flush"
                        id="ov-recent"
                      ></ul>
                    </div>
                  </div>
                </div>

                <!-- Top 5 khoản chi -->
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      Top 5 khoản chi (tháng này)
                    </div>
                    <div class="card-body p-0">
                      <ul class="list-group list-group-flush" id="ov-top5"></ul>
                    </div>
                  </div>
                </div>

                <!-- Chi theo danh mục -->
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      Chi theo danh mục (tháng này)
                    </div>
                    <div class="card-body" id="ov-cat"></div>
                  </div>
                </div>

                <!-- Cảnh báo & ghi chú -->
                <div class="col-lg-6">
                  <div class="card h-100">
                    <div class="card-header fw-semibold">
                      Cảnh báo & ghi chú
                    </div>
                    <div class="card-body" id="ov-alerts">
                      <div class="text-muted">Không có cảnh báo.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== Expenses ========== -->
          <section id="expenses" class="route">
            <div
              class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3"
            >
              <div>
                <h4 class="mb-1">Chi tiêu</h4>
                <div id="expenseFilterInfo" class="text-muted small">
                  Đang hiển thị tất cả khoản chi trong tháng.
                </div>
              </div>

              <!-- Nhóm filter chi tiết -->
              <div
                class="d-flex flex-wrap align-items-center gap-2 filters-group"
                id="expenseFilters"
              >
                <!-- Tháng -->
                <select
                  class="form-select form-select-sm"
                  style="min-width: 140px"
                  id="monthFilter"
                ></select>

                <!-- Danh mục -->
                <select
                  class="form-select form-select-sm"
                  style="min-width: 150px"
                  id="filterCategory"
                >
                  <option value="all">Tất cả danh mục</option>
                </select>

                <!-- Tài khoản -->
                <select
                  class="form-select form-select-sm"
                  style="min-width: 150px"
                  id="filterAccount"
                >
                  <option value="all">Tất cả tài khoản</option>
                </select>

                <!-- Tên / ghi chú -->
                <input
                  type="search"
                  class="form-control form-control-sm"
                  style="min-width: 180px"
                  id="filterSearch"
                  placeholder="Tìm theo tên / ghi chú..."
                />
              </div>
            </div>
            <div class="card p-3">
              <div class="table-responsive">
                <table
                  class="table table-hover align-middle"
                  id="expensesTable"
                >
                  <thead>
                    <tr>
                      <th>Ngày</th>
                      <th>Tên</th>
                      <th>Danh mục</th>
                      <th>Tài khoản</th>
                      <th>Số tiền</th>
                      <th class="text-end">Thao tác</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </section>

          <!-- ========== Add Expense ========== -->
          <section id="add-expense" class="route">
            <div class="row g-3">
              <div class="col-12 col-xl-12">
                <div class="card p-3">
                  <h4>Thêm chi tiêu</h4>
                  <div class="row g-3">
                    <div class="col-12">
                      <label class="form-label">Tên khoản chi</label>
                      <input
                        type="text"
                        class="form-control"
                        id="eName"
                        placeholder="Ví dụ: Coffee sáng"
                      />
                    </div>
                    <div class="col-6">
                      <label class="form-label">Số tiền</label>
                      <input
                        type="number"
                        class="form-control"
                        id="eAmount"
                        placeholder="0"
                      />
                    </div>
                    <div class="col-6">
                      <label class="form-label">Ngày</label>
                      <input type="date" class="form-control" id="eDate" />
                    </div>
                    <div class="col-6">
                      <label class="form-label">Danh mục</label>
                      <select class="form-select" id="eCategory">
                        <option>Ăn uống</option>
                        <option>Coffee</option>
                        <option>
                          Cá nhân (Đồ điện tử, quần áo, giày dép, cắt tóc, ...)
                        </option>
                        <option>Tiền nhà</option>
                        <option>Thể thao</option>
                        <option>Siêu thị</option>
                        <option>Xe cộ</option>
                        <option>Y tế</option>
                        <option>Cho mượn</option>
                        <option>Khác</option>
                      </select>
                    </div>
                    <div class="col-6">
                      <label class="form-label">Tài khoản</label>
                      <select class="form-select" id="eAccount">
                        <option>MSB</option>
                        <option>Sacombank</option>
                        <option>Túi thần tài MoMo</option>
                        <option>VPBank</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Ghi chú</label>
                      <textarea
                        class="form-control"
                        id="eNote"
                        rows="2"
                        placeholder="Mô tả ngắn (tùy chọn)"
                      ></textarea>
                    </div>
                    <div class="col-12 d-flex justify-content-end gap-2">
                      <button class="btn btn-outline-secondary" id="btnDraft">
                        Lưu nháp
                      </button>
                      <button class="btn btn-primary" id="btnAddExpense">
                        Thêm
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== Modals: Account & Income (lần khai báo chính) ========== -->

          <!-- Add Account Modal -->
          <div class="modal" id="addAccountModal" tabindex="-1">
            <div class="modal-dialog modal-md modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Thêm tài khoản</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="mb-2">
                    <label class="form-label">Tên tài khoản</label>
                    <input
                      class="form-control"
                      id="aName"
                      placeholder="VD: MSB, MoMo..."
                    />
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Loại</label>
                    <select class="form-select" id="aType">
                      <option value="bank">Ngân hàng</option>
                      <option value="ewallet">Ví điện tử</option>
                      <option value="other">Khác</option>
                    </select>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="aDefault"
                    />
                    <label class="form-check-label" for="aDefault"
                      >Đặt làm mặc định</label
                    >
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Huỷ
                  </button>
                  <button class="btn btn-primary" id="btnAddAccount">
                    Thêm
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Edit Account Modal -->
          <div class="modal" id="editAccountModal" tabindex="-1">
            <div class="modal-dialog modal-md modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Sửa tài khoản</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" id="eaId" />
                  <div class="mb-2">
                    <label class="form-label">Tên tài khoản</label>
                    <input class="form-control" id="eaName" />
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Loại</label>
                    <select class="form-select" id="eaType">
                      <option value="bank">Ngân hàng</option>
                      <option value="ewallet">Ví điện tử</option>
                      <option value="other">Khác</option>
                    </select>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="eaDefault"
                    />
                    <label class="form-check-label" for="eaDefault"
                      >Đặt làm mặc định</label
                    >
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Huỷ
                  </button>
                  <button class="btn btn-primary" id="btnSaveAccount">
                    Lưu
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Add Income Modal -->
          <div class="modal" id="addIncomeModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Thêm thu nhập</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Tên thu nhập</label>
                      <input
                        class="form-control"
                        id="iName"
                        placeholder="Lương, thưởng, refund..."
                      />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Số tiền</label>
                      <input class="form-control" id="iAmount" type="number" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Ngày</label>
                      <input class="form-control" id="iDate" type="date" />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Tài khoản</label>
                      <select class="form-select" id="iAccount">
                        <!-- danh sách account từ Firestore -->
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Ghi chú</label>
                      <textarea
                        class="form-control"
                        id="iNote"
                        rows="2"
                      ></textarea>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Huỷ
                  </button>
                  <button class="btn btn-primary" id="btnAddIncome">
                    Thêm
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal SỬA THU NHẬP -->
          <div class="modal fade" id="editIncomeModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Sửa thu nhập</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" id="eiId" />
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Tên thu nhập</label>
                      <input class="form-control" id="eiName" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Số tiền</label>
                      <input class="form-control" id="eiAmount" type="number" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Ngày</label>
                      <input class="form-control" id="eiDate" type="date" />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Tài khoản</label>
                      <select class="form-select" id="eiAccount"></select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Ghi chú</label>
                      <textarea
                        class="form-control"
                        id="eiNote"
                        rows="2"
                      ></textarea>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Huỷ
                  </button>
                  <button class="btn btn-primary" id="btnSaveIncome">
                    Lưu thay đổi
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== Accounts section ========== -->
          <section id="accounts" class="route">
            <div class="row g-3">
              <div class="col-12 col-xl-6">
                <div class="card p-3">
                  <!-- Thu nhập trong tháng -->
                  <div class="card mt-3">
                    <div class="card-body">
                      <div
                        class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-2 mb-2"
                      >
                        <h6 class="mb-0">Thu nhập (tháng này)</h6>
                        <div class="d-flex flex-wrap gap-2 income-actions">
                          <button
                            class="btn btn-outline-success btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#transferModal"
                          >
                            ↔️ Chuyển tiền
                          </button>

                          <button
                            class="btn btn-outline-success btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#addIncomeModal"
                          >
                            + Thêm thu nhập
                          </button>
                        </div>
                      </div>
                      <div class="table-responsive">
                        <table class="table align-middle" id="incomesTable">
                          <thead>
                            <tr>
                              <th>Ngày</th>
                              <th>Tên</th>
                              <th>Tài khoản</th>
                              <th>Số tiền</th>
                              <th class="text-end">Thao tác</th>
                            </tr>
                          </thead>
                          <tbody></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 col-xl-6">
                <div class="card p-3">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <h5 class="mb-0">Tài khoản</h5>
                    <div class="d-flex justify-content-end mb-2">
                      <button
                        class="btn btn-primary btn-sm"
                        data-bs-toggle="modal"
                        data-bs-target="#addAccountModal"
                      >
                        + Thêm tài khoản
                      </button>
                    </div>
                  </div>
                  <table class="table align-middle" id="accountsTable">
                    <thead>
                      <tr>
                        <th>Tên</th>
                        <th>Loại</th>
                        <th>Mặc định</th>
                        <th class="text-end">Thao tác</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>

                  <ul class="list-group list-group-flush" id="accountList"></ul>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== Reports ========== -->
          <section id="reports" class="route">
            <div class="row g-3">
              <div class="col-12 col-xl-8">
                <div class="card p-3">
                  <h5>Tổng quan báo cáo</h5>

                  <!-- Bộ lọc báo cáo -->
                  <div class="d-flex flex-wrap align-items-center gap-2 my-3">
                    <!-- Tài khoản -->
                    <select
                      id="accountSelect"
                      class="form-select"
                      style="max-width: 200px"
                    >
                      <option value="all">Tất cả tài khoản</option>
                    </select>

                    <!-- Nút áp dụng -->
                    <button class="btn btn-primary" id="btnApplyReport">
                      <i class="bi bi-funnel me-1"></i> Áp dụng
                    </button>
                  </div>

                  <!-- Nhận xét nhanh -->
                  <div class="card p-3 mb-3" id="reportInsights">
                    <h5 class="mb-2">Nhận xét nhanh</h5>
                    <div id="reportInsightsBody" class="text-muted small">
                      Đang phân tích dữ liệu...
                    </div>
                  </div>

                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="p-3 rounded border" id="barChart">
                        Biểu đồ cột (demo)
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="p-3 rounded border" id="pieChart">
                        Biểu đồ tròn (demo)
                      </div>
                    </div>
                  </div>

                  <div class="mt-3">
                    <div class="table-responsive">
                      <table class="table" id="reportTable">
                        <thead>
                          <tr>
                            <th>Danh mục</th>
                            <th>Tổng</th>
                            <th>Tỉ lệ</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- Card Dòng tiền theo ngày -->
                <div class="row g-3 mt-3">
                  <div class="col-12 col-xl-8">
                    <div class="card p-3">
                      <div
                        class="d-flex justify-content-between align-items-center mb-2"
                      >
                        <h5 class="mb-0">Dòng tiền theo ngày</h5>
                        <small class="text-muted"
                          >Thu &amp; Chi trong tháng hiện tại</small
                        >
                      </div>

                      <div id="cashflowChart" class="cashflow-chart">
                        <div class="text-muted small">Đang tải dữ liệu...</div>
                      </div>

                      <div class="mt-2 small text-secondary">
                        <span class="me-3">
                          <span class="legend-dot legend-dot-exp"></span> Chi
                        </span>
                        <span>
                          <span class="legend-dot legend-dot-inc"></span> Thu
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ========== AI demo ========== -->
          <section id="ai" class="route">
            <div class="card p-3">
              <div class="d-flex align-items-center justify-content-between">
                <h4 class="mb-0">AI hỗ trợ (demo UI)</h4>
                <div class="d-flex gap-2">
                  <span class="chip">Google AI Studio (Gemini)</span>
                  <span class="chip">Ngữ cảnh: Firestore</span>
                </div>
              </div>
              <hr />
              <div
                class="d-flex flex-column gap-2"
                id="chatArea"
                style="min-height: 220px"
              >
                <div class="chat-bubble bot">
                  Xin chào! Mình có thể giúp phân loại chi tiêu, gợi ý ngân
                  sách, cảnh báo vượt trần.
                </div>
              </div>
              <div class="sticky-actions mt-3">
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="bi bi-stars"></i
                  ></span>
                  <input
                    class="form-control"
                    id="aiInput"
                    placeholder="Ví dụ: Đề xuất ngân sách tháng sau cho Ăn uống + Coffee"
                  />
                  <button class="btn btn-primary" id="aiSend">Gửi</button>
                </div>
                <div class="mt-2 d-flex gap-2 flex-wrap">
                  <button class="btn btn-sm btn-outline-secondary">
                    Tóm tắt tháng
                  </button>
                  <button class="btn btn-sm btn-outline-secondary">
                    Tối ưu tài khoản
                  </button>
                  <button class="btn btn-sm btn-outline-secondary">
                    Dự báo chi tiêu
                  </button>
                  <button class="btn btn-sm btn-outline-secondary">
                    Cảnh báo vượt trần
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- Settings (demo – đang tắt) -->
          <!--
          <section id="settings" class="route">
            ...
          </section>
          -->
        </div>

        <!-- Mobile Footer -->
        <footer class="mobile-footer d-none">
          <div class="left">
            <i class="bi bi-wallet2"></i>
            <span class="muted">Tháng này:</span>
            <strong id="footerTotal">—</strong>
          </div>
          <div class="right">
            <a class="btn btn-outline-secondary btn-sm" href="#reports"
              ><i class="bi bi-graph-up"></i> Báo cáo</a
            >
            <a class="btn btn-primary btn-sm" href="#add-expense"
              ><i class="bi bi-plus"></i> Thêm</a
            >
          </div>
        </footer>
      </main>
    </div>

    <!-- Floating Add button -->
    <a href="#add-expense" class="btn btn-primary fab-add" title="Thêm nhanh"
      ><i class="bi bi-plus-lg"></i
    ></a>

    <!-- ================= Toast & Loading ================= -->
    <div
      class="toast-container position-fixed top-0 end-0 p-3"
      style="z-index: 1080"
    >
      <div
        id="appToast"
        class="toast align-items-center border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body">Đã thực hiện xong</div>
          <button
            type="button"
            class="btn-close me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
    </div>

    <div
      id="appLoading"
      class="app-loading d-flex align-items-center justify-content-center"
    >
      <div class="spinner-border" role="status" aria-hidden="true"></div>
    </div>

    <!-- ================= Các modal còn lại (Transfer / Delete / Edit Expense) ================= -->

    <!-- Transfer Modal -->
    <div class="modal fade" id="transferModal" tabindex="-1">
      <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Chuyển tiền giữa tài khoản</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-2">
              <label class="form-label">Từ tài khoản</label>
              <select class="form-select" id="tfFrom"></select>
            </div>
            <div class="mb-2">
              <label class="form-label">Đến tài khoản</label>
              <select class="form-select" id="tfTo"></select>
            </div>
            <div class="row g-2">
              <div class="col-6">
                <label class="form-label">Số tiền</label>
                <input
                  type="number"
                  class="form-control"
                  id="tfAmount"
                  min="0"
                  step="1000"
                />
              </div>
              <div class="col-6">
                <label class="form-label">Ngày</label>
                <input type="date" class="form-control" id="tfDate" />
              </div>
            </div>
            <div class="mt-2">
              <label class="form-label">Ghi chú</label>
              <input
                class="form-control"
                id="tfNote"
                placeholder="Ví dụ: rút tiết kiệm sang MSB"
              />
            </div>
            <div class="form-text mt-2">
              * Chuyển tiền không làm thay đổi tổng Chi/Thu; chỉ ảnh hưởng Số dư
              theo tài khoản.
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Huỷ
            </button>
            <button class="btn btn-primary" id="btnDoTransfer">Chuyển</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1">
      <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Xoá tài khoản</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="daId" />
            <div class="alert alert-warning small">
              Tất cả <b>Chi tiêu</b>, <b>Thu nhập</b> và <b>Chuyển tiền</b> dùng
              tài khoản này sẽ được <b>chuyển sang</b> tài khoản khác trước khi
              xoá.
            </div>
            <label class="form-label">Chuyển sang tài khoản</label>
            <select id="daTarget" class="form-select"></select>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Huỷ
            </button>
            <button class="btn btn-danger" id="btnConfirmDeleteAccount">
              Chuyển & xoá
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Expense Modal -->
    <div class="modal fade" id="editExpenseModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Sửa chi tiêu</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="edId" />
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Tên</label>
                <input id="edName" class="form-control" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Số tiền</label>
                <input id="edAmount" type="number" class="form-control" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Ngày</label>
                <input id="edDate" type="date" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Danh mục</label>
                <select id="edCategory" class="form-select">
                  <option>Ăn uống</option>
                  <option>Coffee</option>
                  <option>
                    Cá nhân (Đồ điện tử, quần áo, giày dép, cắt tóc, ...)
                  </option>
                  <option>Tiền nhà</option>
                  <option>Thể thao</option>
                  <option>Siêu thị</option>
                  <option>Xe cộ</option>
                  <option>Y tế</option>
                  <option>Cho mượn</option>
                  <option>Khác</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Tài khoản</label>
                <select id="edAccount" class="form-select"></select>
              </div>
              <div class="col-12">
                <label class="form-label">Ghi chú</label>
                <textarea id="edNote" rows="2" class="form-control"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Huỷ
            </button>
            <button class="btn btn-primary" id="btnSaveExpense">
              Lưu thay đổi
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirm Delete Expense -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1">
      <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title">Xoá khoản chi?</h6>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p class="mb-0">Hành động này không thể hoàn tác.</p>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Huỷ
            </button>
            <button class="btn btn-danger" id="btnConfirmDelete">Xoá</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ================= Scripts ================= -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./assets/main.js"></script>
    <script type="module">
      // Sidebar toggle (mobile)
      const sidebar = document.querySelector(".sidebar");
      const backdrop = document.getElementById("sidebarBackdrop");
      const toggleBtn = document.getElementById("btnSidebarToggle");

      const closeSidebar = () => {
        sidebar?.classList.remove("show");
        backdrop?.classList.remove("show");
      };

      const openSidebar = () => {
        sidebar?.classList.add("show");
        backdrop?.classList.add("show");
      };

      toggleBtn?.addEventListener("click", () => {
        const isOpen = sidebar?.classList.contains("show");
        if (isOpen) {
          closeSidebar();
        } else {
          openSidebar();
        }
      });

      backdrop?.addEventListener("click", closeSidebar);
      window.addEventListener("hashchange", closeSidebar);
    </script>
  </body>
</html>
